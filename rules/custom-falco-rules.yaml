- list: file_paths
  items:
    - "/opt/*"

- list: excluded_processes
  items:
    - "containerd-shim"
    - "dumb-init"
    - "prometheus-repo"
    - "repo-loader.sh"
    - "entrypoint.sh"

# this macro is a wrapper around excluded process names
- macro: check_proc_name
  condition: >
    not (output_fields.proc.pname in (excluded_processes))

- rule: Detect New Directory
  desc: detect new directory created
  condition: >
    mkdir and check_file_path and check_proc_name
  output: >
    File below a known directory opened for writing (user=%user.name
    command=%proc.cmdline mkdir=%evt.rawarg.path parent=%proc.pname
    pcmdline=%proc.pcmdline gparent=%proc.aname[2])
  priority: NOTICE
  tags: [filesystem]
